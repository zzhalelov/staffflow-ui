<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Добавить отдел</title>

  <!--  <link rel="preconnect" href="https://fonts.googleapis.com">-->
  <!--  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>-->
  <!--  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">-->

  <!--  <style>-->
  <!--    body {-->
  <!--      font-family: "Press Start 2P", "Courier New", monospace;-->
  <!--      background-color: #000;-->
  <!--      color: #0f0;-->
  <!--      padding: 20px;-->
  <!--      line-height: 1.8;-->
  <!--    }-->

  <!--    h1 {-->
  <!--      font-size: 16px;-->
  <!--      margin-bottom: 30px;-->
  <!--    }-->

  <!--    form {-->
  <!--      margin: 30px 0;-->
  <!--    }-->

  <!--    label {-->
  <!--      display: block;-->
  <!--      margin-bottom: 10px;-->
  <!--      font-size: 12px;-->
  <!--    }-->

  <!--    input[type="text"] {-->
  <!--      width: 100%;-->
  <!--      max-width: 400px;-->
  <!--      padding: 10px;-->
  <!--      font-family: "Courier New", monospace;-->
  <!--      font-size: 14px;-->
  <!--      background-color: #000;-->
  <!--      color: #0f0;-->
  <!--      border: 2px solid #0f0;-->
  <!--      margin-bottom: 20px;-->
  <!--    }-->

  <!--    input[type="text"]:focus {-->
  <!--      outline: none;-->
  <!--      box-shadow: 0 0 10px #0f0;-->
  <!--    }-->

  <!--    button {-->
  <!--      font-family: "Press Start 2P", "Courier New", monospace;-->
  <!--      font-size: 12px;-->
  <!--      padding: 10px 20px;-->
  <!--      background-color: #0f0;-->
  <!--      color: #000;-->
  <!--      border: none;-->
  <!--      cursor: pointer;-->
  <!--      margin-right: 10px;-->
  <!--    }-->

  <!--    button:hover {-->
  <!--      background-color: #fff;-->
  <!--      box-shadow: 0 0 10px #0f0;-->
  <!--    }-->

  <!--    button:disabled {-->
  <!--      background-color: #555;-->
  <!--      color: #888;-->
  <!--      cursor: not-allowed;-->
  <!--    }-->

  <!--    a {-->
  <!--      display: inline-block;-->
  <!--      margin-top: 20px;-->
  <!--      color: #0f0;-->
  <!--      text-decoration: none;-->
  <!--      font-size: 12px;-->
  <!--      padding: 5px;-->
  <!--    }-->

  <!--    a:hover {-->
  <!--      background-color: #0f0;-->
  <!--      color: #000;-->
  <!--    }-->

  <!--    .message {-->
  <!--      padding: 10px;-->
  <!--      margin: 20px 0;-->
  <!--      font-size: 12px;-->
  <!--      border: 2px solid;-->
  <!--    }-->

  <!--    .success {-->
  <!--      color: #0f0;-->
  <!--      border-color: #0f0;-->
  <!--      background-color: rgba(0, 255, 0, 0.1);-->
  <!--    }-->

  <!--    .error {-->
  <!--      color: #f00;-->
  <!--      border-color: #f00;-->
  <!--      background-color: rgba(255, 0, 0, 0.1);-->
  <!--    }-->
  <!--  </style>-->
</head>
<body>
<h1>Создание карточки подразделения</h1>

<div id="message"></div>

<form id="departmentForm">
  <label for="name">Наименование:</label>
  <input type="text" id="name" name="name" placeholder="Введите наименование"><br>

  <button type="submit" id="submitBtn">[ СОЗДАТЬ ]</button>
</form>

<a href="department-list">[ НАЗАД К СПИСКУ ]</a>
<br>
<a href="index.html">[ ГЛАВНАЯ ]</a>
<a href="index.html">Вернуться на Главную страницу</a>

<script>
  const API_URL = '/api/departments';
  // const API_URL = 'http://localhost:8081/api/departments';

  const form = document.getElementById('departmentForm');
  const messageDiv = document.getElementById('message');
  const submitBtn = document.getElementById('submitBtn');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const inputName = document.getElementById('name');
    const name = inputName.value.trim();

    if (!name) {
      showMessage('Введите наименование подразделения', 'error');
      return;
    }

    // Отключаем кнопку во время отправки
    submitBtn.disabled = true;
    submitBtn.textContent = '[ ОТПРАВКА... ]';

    try {
      const response = await fetch(API_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({name})
      });

      if (!response.ok) {
        throw new Error(`Ошибка: ${response.status}`);
      }

      const data = await response.json();

      showMessage('Подразделение успешно создано!', 'success');

      // Через 1 секунду перенаправляем на список
      setTimeout(() => {
        window.location.href = 'department.html';
      }, 1000);
    } catch (error) {
      console.error('Ошибка при создании подразделения:', error);
      showMessage(`Ошибка: ${error.message}`, 'error');

      // Включаем кнопку обратно
      submitBtn.disabled = false;
      submitBtn.textContent = '[ СОЗДАТЬ ]';
    }
  });

  function showMessage(text, type) {
    messageDiv.innerHTML = `<div class="message ${type}">${text}</div>`;
  }
</script>

</body>
</html>
