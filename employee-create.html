<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Добавить сотрудника</title>
</head>
<body>
<h1>Добавление сотрудника</h1>

<div id="message"></div>

<form id="employeeForm">
  <label for="lastName">Фамилия:</label><br>
  <input type="text" id="lastName" name="lastName" placeholder="Фамилия"><br><br>

  <label for="firstName">Имя:</label><br>
  <input type="text" id="firstName" name="firstName" placeholder="Имя"><br><br>

  <label for="iin">ИИН:</label><br>
  <input type="text" id="iin" name="iin" placeholder="ИИН"><br><br>

  <label for="gender">Пол:</label><br>
  <select id="gender" name="gender" required>
    <option value="">Выберите пол</option>
    <option value="MALE">Мужской</option>
    <option value="FEMALE">Женский</option>
  </select><br><br>

  <label for="email">Почта:</label><br>
  <input type="email" id="email" name="email" placeholder="Почта"><br><br>

  <label for="phone">Сотовый телефон:</label><br>
  <input type="text" id="phone" name="phone" placeholder="Телефон"><br><br>

  <label for="address">Домашний адрес:</label><br>
  <input type="text" id="address" name="address" placeholder="Адрес"><br><br>

  <label for="citizenship">Гражданство:</label><br>
  <input type="text" id="citizenship" name="citizenship" placeholder="Гражданство"><br><br>

  <button type="submit" id="submitBtn">[ Создать сотрудника ]</button>
</form>

<a href="employee-list">[ НАЗАД К СПИСКУ ]</a>
<br>
<a href="index.html">[ ГЛАВНАЯ ]</a>

<script>
  // const API_URL = "http://localhost:8081/api/employees";
  const API_URL = "/api/employees";

  const form = document.getElementById('employeeForm');
  const messageDiv = document.getElementById('message');
  const submitBtn = document.getElementById('submitBtn');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const inputLastName = document.getElementById('lastName');
    const lastName = inputLastName.value.trim();

    if (!lastName) {
      showMessage('Введите фамилию', 'error');
      return;
    }

    const inputFirstName = document.getElementById('firstName');
    const firstName = inputFirstName.value.trim();

    if (!firstName) {
      showMessage('Введите имя', 'error');
      return;
    }

    const inputIin = document.getElementById('iin');
    const iin = inputIin.value.trim();

    if (!iin) {
      showMessage('Введите ИИН', 'error');
      return;
    }

    const inputGender = document.getElementById('gender');
    const gender = inputGender.value.trim();

    if (!gender) {
      showMessage('Выберите пол', 'error');
      return;
    }

    const inputEmail = document.getElementById('email');
    const email = inputEmail.value.trim();

    if (!email) {
      showMessage('Введите email', 'error');
      return;
    }

    const inputPhone = document.getElementById('phone');
    const phone = inputPhone.value.trim();

    if (!phone) {
      showMessage('Введите телефон', 'error');
      return;
    }

    const inputAddress = document.getElementById('address');
    const address = inputAddress.value.trim();

    if (!address) {
      showMessage('Введите адрес', 'error');
      return;
    }

    const inputCitizenship = document.getElementById('citizenship');
    const citizenship = inputCitizenship.value.trim();

    if (!citizenship) {
      showMessage('Введите гражданство', 'error');
      return;
    }

    // Отключаем кнопку во время отправки
    submitBtn.disabled = true;
    submitBtn.textContent = '[ ОТПРАВКА... ]';

    try {
      // Формируем правильный объект для отправки
      const employeeData = {
        lastName: lastName,
        firstName: firstName,
        iin: iin,
        gender: gender,
        email: email,
        phone: phone,
        address: address,
        citizenship: citizenship
      };

      console.log('Отправляем данные:', employeeData);

      const response = await fetch(API_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(employeeData)
      });

      if (!response.ok) {
        const errorText = await response.text();
        console.error('Ответ сервера:', errorText);
        throw new Error(`Ошибка: ${response.status}`);
      }

      const data = await response.json();
      console.log('Ответ сервера:', data);

      showMessage('Сотрудник успешно создан!', 'success');

      // Через 1 секунду перенаправляем на список
      setTimeout(() => {
        window.location.href = 'employee-list.html';
      }, 1000);
    } catch (error) {
      console.error('Ошибка при создании сотрудника:', error);
      showMessage(`Ошибка: ${error.message}`, 'error');

      // Включаем кнопку обратно
      submitBtn.disabled = false;
      submitBtn.textContent = '[ СОЗДАТЬ СОТРУДНИКА ]';
    }
  });

  function showMessage(text, type) {
    messageDiv.innerHTML = `<div class="message ${type}">${text}</div>`;
  }
</script>
</body>
</html>
