<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ - StaffFlow</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/window.css">
  <link rel="stylesheet" href="/css/form.css">
</head>

<body>

<div class="main-window window-form">

  <!-- TITLEBAR -->
  <div class="window-titlebar">
    <div class="window-title">
      <img src="/icons/folder.png" alt="">
      <span>–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</span>
    </div>
    <div
      class="window-button"
      onclick="location.href='employee-list.html'"
    >√ó
    </div>
  </div>

  <!-- CONTENT -->
  <div class="window-content">

    <form id="employeeForm">

      <div class="form-group">
        <label for="lastName">–§–∞–º–∏–ª–∏—è *</label>
        <input id="lastName" name="lastName" placeholder="Smith" required>
      </div>

      <div class="form-group">
        <label for="firstName">–ò–º—è *</label>
        <input id="firstName" name="firstName" placeholder="John" required>
      </div>

      <div class="form-group">
        <label for="iin">–ò–ò–ù *</label>
        <input id="iin" name="iin" placeholder="123456789012" required>
      </div>

      <div class="form-group">
        <label for="gender">–ü–æ–ª *</label>
        <select id="gender" name="gender" required>
          <option value="">- –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª -</option>
          <option value="MALE">MALE</option>
          <option value="FEMALE">FEMALE</option>
        </select>
      </div>

      <div class="form-group">
        <label for="email">Email *</label>
        <input id="email" name="email" placeholder="john_smith@gmail.com" required>
      </div>

      <div class="form-group">
        <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
        <input id="phone" name="phone" placeholder="+7 777 123 45 67" required>
      </div>

      <div class="form-group">
        <label for="address">–ê–¥—Ä–µ—Å *</label>
        <input id="address" name="address" placeholder="test address" required>
      </div>

      <div class="form-group">
        <label for="citizenship">–ì—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ *</label>
        <input id="citizenship" name="citizenship" placeholder="Narnia" required>
      </div>

      <div class="button-container">
        <button type="submit">üíæ –°–æ–∑–¥–∞—Ç—å</button>
        <a href="employee-list.html" class="button">‚ùå –û—Ç–º–µ–Ω–∞</a>
      </div>
    </form>
  </div>
</div>

<!-- Toast container -->
<div id="toast-container"></div>

<!-- Toast -->
<script src="/js/ui-toast.js"></script>
<script src="/js/ui-forbidden.js"></script>
<script src="/js/api.js"></script>
<script src="/js/auth.js"></script>
<!-- Page logic -->
<script>
  // const API_URL = "http://localhost:8081/api/employees";
  // const API_URL = '/api/employees';
  const form = document.getElementById('employeeForm');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const lastName = document.getElementById('lastName').value.trim();
    const firstName = document.getElementById('firstName').value.trim();
    const iin = document.getElementById('iin').value.trim();
    const gender = document.getElementById('gender').value;
    const email = document.getElementById('email').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const address = document.getElementById('address').value.trim();
    const citizenship = document.getElementById('citizenship').value.trim();

    // Validation
    if (!lastName || !firstName || !iin || !gender || !email || !phone || !address || !citizenship) {
      toast.error('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
      return;
    }

    if (!/^\d{12}$/.test(iin)) {
      toast.error('–ò–ò–ù –¥–æ–ª–∂–µ–Ω —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ 12 —Ü–∏—Ñ—Ä', 'error')
      return;
    }

    const payload = {
      lastName, firstName, iin, gender, email, phone, address, citizenship
    };

    try {
      toast.info('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');

      const response = await apiFetch('/api/employees', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(payload)
      });

      if (!response.ok) {
        throw new Error(response.status);
      }

      toast.success('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å–æ–∑–¥–∞–Ω');

      setTimeout(() => {
        window.location.href = 'employee-list.html';
      }, 800);

    } catch (err) {
      console.error(err);
      toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏')
    }
  });
</script>

<!-- UI helpers -->
<script src="/js/ui-draggable.js"></script>

</body>
</html>
